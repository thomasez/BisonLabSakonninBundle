<script type="text/javascript">

function grabEditMessageForm(message_id) {
    orgurl = "{{ path('message_edit', {'id': 0, 'access': 'ajax' }) }}";
    url = orgurl.replace("0", message_id);
    $.get(url, function( data ) {
        $( "#editmessage" ).html(data);
        $( "#editmessagebox" ).modal();
        $( "#editMessageForm" ).submit(function( event ) {
            event.preventDefault();
            submitEditMessageForm(message_id);
        });
    });
    return false;
}

function submitEditMessageForm(message_id) {

    orgurl = "{{ path('message_edit', {'id': 0, 'access': 'ajax' }) }}";
    url = orgurl.replace("0", message_id);
    formdata = $( "#editMessageForm" ).serialize();
    $.ajax({
        beforeSend: function(req) {
          req.setRequestHeader("Accept", "application/json");
        },
        type: "POST",
        url: url,
        data: formdata,
        dataType: "text",
        async: true,
      }).done( function( cont, textStatus, xhr ) {
            $( "#editmessagebox").modal("hide");
{% if reload_after_post is defined and reload_after_post %}
            parent.location.reload();
{% endif %}
      }).fail(function(xhr, status, error) {
            errmsg = "Message sending failed\n";
            errmsg = errmsg + xhr.responseText + "\n";
            alert(errmsg);
    });
    return false;
}
</script>
<div class="modal fade" id="editmessagebox" role="dialog" tabindex='-1'>
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
{% if title is defined %}
          <h4 class="modal-title">{{ title }}</h4>
{% else %}
          <h4 class="modal-title">Edit</h4>
{% endif %}
      </div>
      <div class="modal-body">
            <div id="editmessage">
            </div>
      </div>
<!-- Not sure I want it.
      <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
-->
    </div>
  </div>
</div>
