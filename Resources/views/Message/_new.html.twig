{{ form_start(form, { 'attr': {'id':'createMessageForm', 'onSubmit': 'return submitCreateMessage();'}}) }}
    {{ form_widget(form) }}
    <input type="submit" value="Create" />
{{ form_end(form) }}

<script>

function submitCreateMessage() {
    createMessageData = $( "#createMessageForm" ).serialize();
    $.ajax({
        beforeSend: function(req) {
          req.setRequestHeader("Accept", "application/json");
        },
        type: "POST",
        url: "{{ action }}",
        data: createMessageData,
        dataType: "text",
        async: true,
      }).done( function( cont, textStatus, xhr ) {
{% if reload_after_post %}
         parent.location.reload();
{% else %}
        return;
{% endif %}
      }).fail(function(xhr, status, error) {
         errmsg = "Failed createing message\n";
         errmsg = errmsg + xhr.responseText + "\n";
         alert(errmsg);
    });
    return false;
}

</script>
